@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import components.gds.{gds_main_template, pageTitle}
@import java.time.format.DateTimeFormatter
@import models.notifications.Notification
@import models.submissions.Submission
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import views.components.BackButton
@import views.Title

@this(
  govukLayout: gds_main_template,
  pageTitle: pageTitle,
  table: GovukTable,
  formatter: DateTimeFormatter
)

@(submissions: Seq[(Submission, Seq[Notification])])(implicit request: Request[_], messages: Messages)

@ucrCellContent(submission: Submission, notifications: Seq[Notification]) = {
  @if(notifications.isEmpty){
    @components.elements_in_separate_lines(submission.ucrBlocks.map(_.ucr))
  } else {
    <a href="@routes.NotificationsController.listOfNotifications(submission.conversationId)">
      @components.elements_in_separate_lines(submission.ucrBlocks.map(_.ucr))
    </a>
  }
}

@ucrClass = @{"ucr"}
@submissionTypeClass = @{"submission-type"}
@dateOfRequestClass = @{"date-of-request"}
@submissionActionClass = @{"submission-action"}


@govukLayout(
  title = Title("submissions.title"),
  backButton = Some(BackButton(
    title = messages("site.back.toStartPage"),
    call = controllers.routes.ChoiceController.displayChoiceForm()
  )),
  useCustomContentWidth = true
) {

  <div class="govuk-grid-row">

    <div class="govuk-grid-column-two-thirds">
      @pageTitle(messages("submissions.title"))

      <p class="govuk-body-l">@messages("submissions.summary") </p>
    </div>

    <div class="govuk-grid-column-full">
      @table(Table(
        head = Some(Seq(
          HeadCell(
            content = Text(messages("submissions.ucr")),
            classes = ucrClass
          ),
          HeadCell(
            content = Text(messages("submissions.submissionType")),
            classes = submissionTypeClass
          ),
          HeadCell(
            content = Text(messages("submissions.dateOfRequest")),
            classes = dateOfRequestClass
          ),
          HeadCell(
            content = Text(messages("submissions.submissionAction")),
            classes = submissionActionClass
          )
        )),
        firstCellIsHeader = false,
        rows = submissions.map { case (submission, notifications) =>
          Seq(
            TableRow(
              content = HtmlContent(ucrCellContent(submission, notifications)),
              classes = ucrClass
            ),
            TableRow(
              content = HtmlContent(components.elements_in_separate_lines(submission.ucrBlocks.map(_.ucrType + "UCR"))),
              classes = submissionTypeClass
            ),
            TableRow(
              content = Text(formatter.format(submission.requestTimestamp)),
              classes = dateOfRequestClass
            ),
            TableRow(
              content = Text(messages(s"submissions.${submission.actionType.toString.toLowerCase}")),
              classes = submissionActionClass
            )
          )
        }
      ))
    </div>

  </div>
}
